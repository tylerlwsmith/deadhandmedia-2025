---
import Page from "src/layouts/Page.astro";
import { getCollection } from "astro:content";

const blogPosts = (await getCollection("blog")).map(
  (blogPost) => blogPost.data
);

const postsByYear = Object.groupBy(blogPosts, (post) => {
  return new Date(post.publishedTimestamp).getFullYear().toString();
});

// Need to keep as entries because JS will sort numbered keys.
const postByYearDescEntries = Object.entries(postsByYear).toSorted((a, b) =>
  a[0] < b[0] ? 1 : -1
);
---

<Page title="Blog">
  {
    postByYearDescEntries.map(([year, posts]) => (
      <div>
        {year}{" "}
        {posts?.length === 1
          ? `${posts?.length} post`
          : `${posts?.length} posts`}
      </div>
    ))
  }
</Page>
